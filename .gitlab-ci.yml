stages:
  - Puppet 5
  - push2github

16.04:rundeck2:puppet5:
  stage: Puppet 5
  image: scalecommerce/xenial:1.11
  script:
    - ./test/install.sh
    - puppet apply -v test/site.pp
    - puppet apply -v test/site.pp
    - "# waiting for rundeck to start ..."
    - while ! nc -z localhost 4440 ; do sleep 1 ; done
    - inspec exec test/inspec/sc_rundeck.rb

push2github:
  stage: push2github
  script:
    - git push --quiet --mirror https://$GITHUB_TOKEN@github.com/ScaleCommerce/puppet-sc_rundeck.git
